<html>
<head>
    <title>Romoアプリ</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">

    <!-- build:css css/build_mute.css -->
    <link href="bower_components/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link href="bower_components/fontawesome/css/font-awesome.min.css" rel="stylesheet">
    <link href="css/all.css" rel="stylesheet">
    <!-- endbuild -->

    <!-- build:js js/build_mute.js -->
    <script type="text/javascript" src="bower_components/eventemitter2/eventemitter2.js"></script>
    <script type="text/javascript" src="bower_components/lodash/lodash.compat.js"></script>
    <script type="text/javascript" src="bower_components/jquery/jquery.js"></script>
    <script type="text/javascript" src="js/views/Inputs/UserInputs.js" charset="UTF-8"></script>
    <script type="text/javascript" src="js/views/Inputs/Gamepad.js" charset="UTF-8"></script>
    <script type="text/javascript" src="js/views/Inputs/Keyboard.js" charset="UTF-8"></script>
    <script type="text/javascript" src="js/views/Inputs/RaceDashboard.js" charset="UTF-8"></script>
    <script type="text/javascript" src="js/views/Inputs/MainUserView.js" charset="UTF-8"></script>
    <script type="text/javascript" src="js/models/PeerManager.js" charset="UTF-8"></script>
    <script type="text/javascript" src="js/controllers/MainController.js" charset="UTF-8"></script>
    <!-- endbuild -->

    <script type="text/javascript" src="https://skyway.io/dist/0.3/peer.js" charset="UTF-8"></script>

</head>

<body>
<div id="main">
    <div id="race-window">
        <div id="top"></div>
        <video id="remote-video" autoplay></video>
        <div id="local-trim">
            <video id="local-video" muted="true" autoplay></video>
            <img id="romo-view" src="./img/romo.png" style="display:none">
        </div>
        <div id="car-images">
            <img id="wiper-left" class="wiper" src="img/wiper.png">
            <img id="wiper-right" class="wiper" src="img/wiper.png">
            <img id="handle" class="StopMoving" src="./img/handle.png">
            <img id="dashboard" src="./img/dashboard-wide.png">
            <img id="string" class="StopMoving" src="./img/string.png">
            <img id="ios-string" src="./img/mini-string.png">
            <img id="vehicle-string" src="./img/mini-string.png">
            <div id="under"></div>
        </div>
    </div>
    <div  id="main-window">
        <div id="control-window">
            <div>
                <input type="image" src="./img/camera-icon.png" id="Romo" class="romo-control-btn" name="Camera" style="width:80px;height:80px;" />
                <button id="mute-btn" class="btn btn-lg btn-primary" name="ON" style="width: 50%;"><i class="fa fa-microphone"></i>  Microfone ON</button>
            </div>
        </div>
        <div id="photo-window">
            <div id="photo-btn-window">
                <button id="photo-btn" class="btn btn-lg btn-primary"><i class="fa fa-camera"></i>  Take a Picture </button>
            </div>
            <canvas id="tmp-canvas" style="display:none"></canvas>
            <div id="photo-lib"></div>

        </div>
    </div>
</div>
<script type="text/javascript">

    window.onload = function(){
        main_window_change_position();
        if(!judgeRomo()){
            $("#remote-video").css({
                "-webkit-transform": 'rotate(180deg)',
                "-moz-transform": 'rotate(180deg)',
                "-o-transform": 'rotate(180deg)',
                "-ms-transform": 'rotate(180deg)'
            });
        }
        $("#local-video").on("playing",function(){
            local_video_reflow();
        });

        var controller_video = new Vehicle.MainController("mute",$("#local-video"),$("#remote-video"));
    };

    var window_resize_timer = false;
    $(window).resize(function() {
        if (window_resize_timer !== false) {
            clearTimeout(window_resize_timer);
        }
        window_resize_timer = setTimeout(function() {
            main_window_change_position();
        }, 100);
    });

    function main_window_change_position(){
        var win_width=$(window).width();
        var win_height=$(window).height();

        var remote_video_height = win_width*0.5*4/3;
        var remote_video_top = -1 * (remote_video_height - win_height);
        $("#remote-video").css({
            "height":remote_video_height,
            "top": remote_video_top
        });

        var photo_window_height = win_height - 130;
        var photo_lib_height = photo_window_height - 70 + "px";
        $("#photo-window").css("height",photo_window_height);
        $("#photo-lib").css("height",photo_lib_height);
    }

    function local_video_reflow(){
        var $local = $("#local-video");
        var asp = $local[0].videoWidth / $local[0].videoHeight;
        var trim_x = ((9.6 * asp) - 5.4) / 2 * -1 + "vw";
        $local.css("left",trim_x);
    }

    function judgeRomo(){
        var isRomo = true;
        var temp_params = window.location.search.substring(1).split('&');
        for(var i = 0; i < temp_params.length; i++) {
            var params = temp_params[i].split('=');
            if (params[1].indexOf('Double') === 0) {
                isRomo = false;
            }
        }
        return isRomo;
    }

</script>

</body>
</html>