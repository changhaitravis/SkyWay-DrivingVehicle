<html>
<head>
    <title>Romoアプリ</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">

    <!-- build:css css/build_android.css -->
    <link href="bower_components/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link href="bower_components/fontawesome/css/font-awesome.min.css" rel="stylesheet">
    <link href="css/android.css" rel="stylesheet">
    <!-- endbuild -->

    <!-- build:js js/build_android.js -->
    <script type="text/javascript" src="bower_components/eventemitter2/eventemitter2.js"></script>
    <script type="text/javascript" src="bower_components/lodash/lodash.compat.js"></script>
    <script type="text/javascript" src="bower_components/jquery/jquery.js"></script>
    <script type="text/javascript" src="js/views/Inputs/UserInputs.js" charset="UTF-8"></script>
    <script type="text/javascript" src="js/views/Inputs/Gamepad.js" charset="UTF-8"></script>
    <script type="text/javascript" src="js/views/Inputs/Keyboard.js" charset="UTF-8"></script>
    <script type="text/javascript" src="js/views/Inputs/AndroidUserView.js" charset="UTF-8"></script>
    <script type="text/javascript" src="js/models/PeerManager.js" charset="UTF-8"></script>
    <script type="text/javascript" src="js/controllers/AndroidMainController.js" charset="UTF-8"></script>
    <!-- endbuild -->

    <script type="text/javascript" src="https://skyway.io/dist/0.3/peer.js" charset="UTF-8"></script>


</head>

<body oncontextmenu='return false;' oncopy='return false;'>
<div id="race-window">
    <div id="top">
        <img src="./img/gallery.png" id="Gallery" class="top-icon" />
        <img src="./img/camera.png" id="Camera" class="top-icon" />
        <img src="./img/camera-icon.png" id="Romo" class="romo-control-btn top-icon" name="Camera" />
    </div>
    <video id="remote-video" autoplay></video>
    <div id="controller">
        <div id="left" class="arrow" ><img src="./img/arrow-left.png"></div>
        <div id="right" class="arrow" ><img src="./img/arrow-left.png"></div>
        <div id="front" class="arrow" ><img src="./img/arrow-front.png"></div>
        <div id="back" class="arrow" ><img src="./img/arrow-front.png"></div>
    </div>
    <div id="local-trim">
        <video id="local-video" muted="true" autoplay></video>
        <img id="romo-view" src="./img/romo.png" style="display:none">
    </div>
    <div id="photo-div" style="display: none">
        <canvas id="tmp-canvas" style="display:none"></canvas>
        <div id="photo-lib"></div>
    </div>

</div>
<script type="text/javascript">

    window.onload = function(){
        if(!judgeRomo()){
            $("#remote-video").css({
                "-webkit-transform": 'rotate(180deg)',
                "-moz-transform": 'rotate(180deg)',
                "-o-transform": 'rotate(180deg)',
                "-ms-transform": 'rotate(180deg)'
            });
        }
        $("#local-video").on("playing",function(){
            local_video_reflow();
        });

        var controller_video = new Vehicle.AndroidMainController("video",$("#local-video"),$("#remote-video"));
    };

    function local_video_reflow(){
        var $local = $("#local-video");
        var asp = $local[0].videoWidth / $local[0].videoHeight;
        var trim_x = ((16 * asp) - 9) / 2 * -1 + "vh";
        $local.css("left",trim_x);
    }

    function judgeRomo(){
        var isRomo = true;
        var temp_params = window.location.search.substring(1).split('&');
        for(var i = 0; i < temp_params.length; i++) {
            var params = temp_params[i].split('=');
            if (params[1].indexOf('Double') === 0) {
                isRomo = false;
            }
        }
        return isRomo;
    }


</script>

</body>
</html>